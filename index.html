<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëˆì˜ íë¦„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: white;
            color: #374151;
            overflow-x: hidden;
            display: flex;
            min-height: 100vh;
        }

        .main-layout {
            display: flex;
            width: 100%;
        }

        .container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .svg-container {
            touch-action: none; /* í„°ì¹˜ ì´ë²¤íŠ¸ ì œì–´ë¥¼ ìœ„í•´ ì¶”ê°€ */
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .steps-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
            gap: 2rem;
            padding-top: 2rem;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            transition: all 0.5s;
            border: 1px solid transparent;
        }

        .step.active-red {
            background-color: #fef2f2;
            color: #b91c1c;
            border-color: #fecaca;
        }

        .step.active-orange {
            background-color: #fff7ed;
            color: #c2410c;
            border-color: #fed7aa;
        }

        .step.active-green {
            background-color: #f0fdf4;
            color: #166534;
            border-color: #bbf7d0;
        }

        .step.inactive {
            background-color: #f3f4f6;
            color: #6b7280;
        }

        .step-number {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
        }

        .step-number.red { background-color: #ef4444; }
        .step-number.orange { background-color: #f97316; }
        .step-number.green { background-color: #22c55e; }
        .step-number.gray { background-color: #9ca3af; }

        .reset-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background-color: #f3f4f6;
            color: #6b7280;
            border: 1px solid #d1d5db;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .reset-btn:hover {
            background-color: #e5e7eb;
            color: #374151;
            border-color: #9ca3af;
        }

        .node-group {
            cursor: grab;
        }
        
        .node-group:active {
            cursor: grabbing;
        }

        .connection-line {
            transition: all 0.7s;
        }

        .solution-panel {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            width: 24rem;
            max-width: 90vw;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.5s ease-out;
            z-index: 50;
        }

        .solution-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .solution-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .solution-card {
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .solution-details {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .solution-left {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .solution-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .solution-right {
            text-align: right;
        }

        .savings-amount {
            font-weight: bold;
            font-size: 1.125rem;
            color: #059669;
        }

        .savings-period {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .solution-tip {
            font-size: 0.75rem;
            color: #6b7280;
            background: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }

        .solution-btn {
            width: 100%;
            background-color: #dc2626;
            color: white;
            font-weight: 500;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .solution-btn:hover {
            background-color: #b91c1c;
        }

        .usage-guide {
            text-align: center;
            margin: 1rem 0 2rem;
        }

        .usage-text {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .analysis-text {
            color: #ef4444;
            font-size: 0.875rem;
            animation: pulse 2s infinite;
        }

        .guide-panel {
            width: 350px;
            flex-shrink: 0;
            background-color: #f9fafb;
            border-left: 1px solid #e5e7eb;
            padding: 2rem;
            overflow-y: auto;
        }

        .guide-panel h2 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .guide-panel h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .guide-panel p {
            font-size: 0.875rem;
            line-height: 1.6;
            color: #4b5563;
        }
        
        .guide-panel p strong {
            color: #1f2937;
            font-weight: 600;
        }

        .guide-panel .tip {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f3f4f6;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        @media (max-width: 1024px) {
            .main-layout {
                flex-direction: column;
            }
            .guide-panel {
                width: 100%;
                border-left: none;
                border-top: 1px solid #e5e7eb;
            }
        }

        @keyframes slideUp { from { opacity: 0; transform: translateX(-50%) translateY(20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); } 50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); } }
        .animate-ping { animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="container">
            <!-- ì¸í„°ë™ì…˜ ë‹¨ê³„ í‘œì‹œ -->
            <div class="steps-container">
                <div id="step1" class="step inactive">
                    <span class="step-number gray">1</span>
                    <span>íƒìƒ‰ (Explore)</span>
                </div>
                <div id="step2" class="step inactive">
                    <span class="step-number gray">2</span>
                    <span>ë°œê²¬ (Discover)</span>
                </div>
                <div id="step3" class="step inactive">
                    <span class="step-number gray">3</span>
                    <span>í•´ê²° (Solve)</span>
                </div>
                
                <!-- ë¦¬ì…‹ ë²„íŠ¼ -->
                <button id="reset-btn" class="reset-btn" style="display: none;" title="ì²˜ìŒ ìƒíƒœë¡œ ëŒì•„ê°€ê¸°">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                    <span>ì´ˆê¸°í™”</span>
                </button>
            </div>
            <!-- ë©”ì¸ ì‹œê°í™” ì˜ì—­ -->
            <div class="svg-container">
                <svg id="money-map-svg" width="800" height="600" style="max-width: 100%; height: auto;">
                    <!-- ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ -->
                    <defs>
                        <radialGradient id="bgGradient" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stop-color="rgba(156, 163, 175, 0.03)" />
                            <stop offset="100%" stop-color="rgba(255, 255, 255, 0)" />
                        </radialGradient>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                 <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        <!-- í™”ì‚´í‘œ ë§ˆì»¤ ì •ì˜ -->
                        <marker id="arrowhead" markerWidth="30" markerHeight="21" refX="27" refY="10.5" orient="auto" markerUnits="userSpaceOnUse">
                            <polygon points="0 0, 30 10.5, 0 21" fill="#dc2626" />
                        </marker>
                        <marker id="arrowhead-inactive" markerWidth="30" markerHeight="21" refX="27" refY="10.5" orient="auto" markerUnits="userSpaceOnUse">
                            <polygon points="0 0, 30 10.5, 0 21" fill="#9ca3af" />
                        </marker>
                    </defs>
                    <circle cx="400" cy="300" r="200" fill="url(#bgGradient)" />
                    <!-- ì—°ê²°ì„ ë“¤ -->
                    <g id="connections"></g>
                    <!-- ë…¸ë“œë“¤ -->
                    <g id="nodes"></g>
                </svg>
            </div>
            <!-- ì‚¬ìš© ì•ˆë‚´ -->
            <div class="usage-guide">
                <p id="usage-text" class="usage-text">ğŸ’¡ ë¨¼ì € ì¤‘ì•™ì˜ 'ì´ ì§€ì¶œ' ë…¸ë“œë¥¼ í´ë¦­í•˜ì—¬ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
                <p id="analysis-text" class="analysis-text" style="display: none;"></p>
            </div>
            <!-- ì†”ë£¨ì…˜ íŒ¨ë„ -->
            <div id="solution-panel" class="solution-panel" style="display: none;"></div>
        </div>
        <div class="guide-panel">
            <h2>ğŸ’¡ ëˆì˜ ì§€ë„ í™œìš©ë²•</h2>
            <p>ì´ ë„êµ¬ëŠ” ë‹¹ì‹ ì˜ ì§€ì¶œ íë¦„ì„ ì‹œê°ì ìœ¼ë¡œ ë¶„ì„í•˜ê³ , ì ˆì•½ ê°€ëŠ¥í•œ ë¶€ë¶„ì„ ì°¾ì•„ ìŠ¤ë§ˆíŠ¸í•œ ì œì•ˆì„ ì œê³µí•©ë‹ˆë‹¤. ì•„ë˜ì˜ 3ë‹¨ê³„ë¥¼ ë”°ë¼ ë‹¹ì‹ ì˜ ëˆì˜ íë¦„ì„ íƒí—˜í•´ë³´ì„¸ìš”.</p>
            
            <h4>1. íƒìƒ‰ (Explore)</h4>
            <p>ë¨¼ì € ì¤‘ì•™ì— ìˆëŠ” <strong>'ì´ ì§€ì¶œ'</strong> ë…¸ë“œë¥¼ í´ë¦­í•˜ì—¬ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”. ì „ì²´ ì§€ì¶œì´ ê° í•­ëª©ìœ¼ë¡œ ì–´ë–»ê²Œ í˜ëŸ¬ê°€ëŠ”ì§€ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <h4>2. ë°œê²¬ (Discover)</h4>
            <p>ê´€ì‹¬ ìˆëŠ” ì§€ì¶œ í•­ëª©(ì˜ˆ: <strong>'í†µì‹ ë¹„'</strong>, <strong>'ì£¼ê±°ë¹„'</strong>)ì„ í´ë¦­í•˜ë©´ AIê°€ í•´ë‹¹ í•­ëª©ì˜ ì„¸ë¶€ ë‚´ì—­ì„ ì‹¬ì¸µ ë¶„ì„í•©ë‹ˆë‹¤. ë¹„íš¨ìœ¨ì ì¸ ì§€ì¶œë¡œ íŒë‹¨ë˜ëŠ” í•­ëª©ì€ <strong>'âš ï¸'</strong> ì•„ì´ì½˜ê³¼ í•¨ê»˜ ë¶‰ê²Œ í‘œì‹œë©ë‹ˆë‹¤.</p>

            <h4>3. í•´ê²° (Solve)</h4>
            <p>ë¶„ì„ì´ ì™„ë£Œë˜ë©´ í™”ë©´ í•˜ë‹¨ì— <strong>'ìŠ¤ë§ˆíŠ¸ ì œì•ˆ'</strong> íŒ¨ë„ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì´ íŒ¨ë„ì—ì„œëŠ” í†µì‹  ìš”ê¸ˆì œ ë³€ê²½, ì„¸ì•¡ ê³µì œ ì‹ ì²­ ë“± ì¦‰ì‹œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ì ˆì•½ ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <h4>ê¸°íƒ€ ê¸°ëŠ¥</h4>
            <p><strong>ë“œë˜ê·¸ & ë“œë¡­:</strong> ê° ì§€ì¶œ ë…¸ë“œë¥¼ ë§ˆìš°ìŠ¤ë¡œ ëŒì–´ ì›í•˜ëŠ” ìœ„ì¹˜ë¡œ ì˜®ê¸°ë©° ì§€ë„ë¥¼ ììœ ë¡­ê²Œ ì¬êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            <strong>ì´ˆê¸°í™”:</strong> ìƒë‹¨ì˜ 'ì´ˆê¸°í™”' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ëª¨ë“  ë¶„ì„ ìƒíƒœê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</p>
        </div>
    </div>
    <script>
        // --- ìƒíƒœ ë° ë°ì´í„° ---
        let state = {
            selectedNode: null,
            discoveryPhase: 0,
            showSolution: false,
            animationStep: 0,
            draggedNode: null,
            isDragging: false,
            dragStartX: 0,
            dragStartY: 0,
        };
        const nodes = [
            { id: 'center', x: 400, y: 300, vx: 0, vy: 0, size: 60, label: 'ì›” ì´ ì§€ì¶œ', amount: '3,245,600ì›', type: 'center', detail: '2025ë…„ 1ì›”' },
            { id: 'home', x: 200, y: 150, vx: 0, vy: 0, size: 50, label: 'ì£¼ê±°ë¹„', amount: '1,200,000ì›', type: 'major', detail: 'Kì€í–‰ ****-2847', subDetails: ['ì›”ì„¸ 100ë§Œì›', 'ê´€ë¦¬ë¹„ 20ë§Œì›'] },
            { id: 'food', x: 600, y: 150, vx: 0, vy: 0, size: 45, label: 'ì‹ë¹„', amount: '856,200ì›', type: 'major', detail: 'Sì€í–‰ ****-1234', subDetails: ['ì™¸ì‹ 52ë§Œì›', 'ë§ˆíŠ¸ 24ë§Œì›', 'ë°°ë‹¬ 11ë§Œì›'] },
            { id: 'transport', x: 150, y: 380, vx: 0, vy: 0, size: 40, label: 'êµí†µë¹„', amount: '485,300ì›', type: 'regular', detail: 'Hì¹´ë“œ ****-5678', subDetails: ['ì£¼ìœ ë¹„ 32ë§Œì›', 'ì§€í•˜ì²  8ë§Œì›', 'íƒì‹œ 6ë§Œì›'] },
            { id: 'shopping', x: 650, y: 380, vx: 0, vy: 0, size: 35, label: 'ì‡¼í•‘', amount: '324,800ì›', type: 'regular', detail: 'Sì¹´ë“œ ****-9012', subDetails: ['ì˜ë¥˜ 18ë§Œì›', 'ì˜¨ë¼ì¸ 12ë§Œì›'] },
            { id: 'phone', x: 280, y: 480, vx: 0, vy: 0, size: 30, label: 'í†µì‹ ë¹„', amount: '89,500ì›', type: 'small', detail: 'AlphaT ìë™ì´ì²´', subDetails: ['ìš”ê¸ˆì œ 6.5ë§Œì›', 'ë¶€ê°€ì„œë¹„ìŠ¤ 2.4ë§Œì›'], inefficient: true, reason: 'ìœ ì‚¬ ì„œë¹„ìŠ¤ ëŒ€ë¹„ ìš”ê¸ˆ ë†’ìŒ' },
            { id: 'utility', x: 520, y: 480, vx: 0, vy: 0, size: 30, label: 'ê³µê³¼ê¸ˆ', amount: '156,800ì›', type: 'small', detail: 'Wì€í–‰ ****-7890', subDetails: ['ì „ê¸°ë£Œ 8ë§Œì›', 'ê°€ìŠ¤ë£Œ 5ë§Œì›', 'ìˆ˜ë„ë£Œ 2ë§Œì›'], inefficient: true, reason: 'ëˆ„ì§„ì„¸ 3ë‹¨ê³„ ì§„ì…' }
        ];
        const connections = [
            { from: 'center', to: 'home' },
            { from: 'center', to: 'food' },
            { from: 'center', to: 'transport' },
            { from: 'center', to: 'shopping' },
            { from: 'center', to: 'phone' },
            { from: 'center', to: 'utility' }
        ];

        // --- ë¬¼ë¦¬ ì—”ì§„ ì„¤ì • ---
        const physics = {
            repulsion: 8000,
            spring: 0.05,
            idealLength: 250,
            centering: 0.01,
            damping: 0.95
        };

        // --- DOM ìš”ì†Œ ---
        const svg = document.getElementById('money-map-svg');
        const nodesGroup = document.getElementById('nodes');
        const connectionsGroup = document.getElementById('connections');

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function calculateLinePoints(fromNode, toNode) {
            const dx = toNode.x - fromNode.x;
            const dy = toNode.y - fromNode.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance === 0) return { startX: fromNode.x, startY: fromNode.y, endX: toNode.x, endY: toNode.y };
            const unitX = dx / distance;
            const unitY = dy / distance;
            const startX = fromNode.x + unitX * fromNode.size;
            const startY = fromNode.y + unitY * fromNode.size;
            const endX = toNode.x - unitX * toNode.size;
            const endY = toNode.y - unitY * toNode.size;
            return { startX, startY, endX, endY };
        }
        function isConnectionActive(connection) { return state.selectedNode && (connection.from === state.selectedNode || connection.to === state.selectedNode); }
        function isNodeHighlighted(node) {
            if (!state.selectedNode) return false;
            if (node.id === state.selectedNode) return true;
            return connections.some(conn => (conn.from === state.selectedNode && conn.to === node.id) || (conn.to === state.selectedNode && conn.from === node.id));
        }

        // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        function handleNodeClick(nodeId) {
            if (state.selectedNode === nodeId) return; // ì´ë¯¸ ì„ íƒëœ ë…¸ë“œëŠ” ë‹¤ì‹œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ

            state.selectedNode = nodeId;
            state.discoveryPhase = 0;
            state.showSolution = false;
            state.animationStep++;
            startAnimationSequence();
        }
        function handleReset() {
            state.selectedNode = null;
            state.discoveryPhase = 0;
            state.showSolution = false;
            state.animationStep = 0;
        }
        
        // --- ë“œë˜ê·¸ í•¸ë“¤ëŸ¬ ---
        function getMousePosition(evt) {
            const CTM = svg.getScreenCTM();
            let clientX, clientY;
            if (evt.touches && evt.touches.length > 0) {
                clientX = evt.touches[0].clientX;
                clientY = evt.touches[0].clientY;
            } else if (evt.changedTouches && evt.changedTouches.length > 0) {
                clientX = evt.changedTouches[0].clientX;
                clientY = evt.changedTouches[0].clientY;
            } else {
                clientX = evt.clientX;
                clientY = evt.clientY;
            }
            return {
                x: (clientX - CTM.e) / CTM.a,
                y: (clientY - CTM.f) / CTM.d
            };
        }

        function onDragStart(evt) {
            evt.preventDefault();
            const targetNodeId = evt.target.closest('.node-group')?.dataset.id;
            if (targetNodeId) {
                state.draggedNode = nodes.find(n => n.id === targetNodeId);
                if (state.draggedNode) {
                    state.isDragging = true;
                    const mousePos = getMousePosition(evt);
                    state.dragStartX = mousePos.x;
                    state.dragStartY = mousePos.y;
                }
            }
        }
        
        function onDrag(evt) {
            if (state.isDragging && state.draggedNode && state.draggedNode.id !== 'center') {
                evt.preventDefault();
                const mousePos = getMousePosition(evt);
                state.draggedNode.x = mousePos.x;
                state.draggedNode.y = mousePos.y;
                state.draggedNode.vx = 0; // ë“œë˜ê·¸ ì¤‘ì—ëŠ” ë¬¼ë¦¬ì  ì†ë„ ì´ˆê¸°í™”
                state.draggedNode.vy = 0;
            }
        }

        function onDragEnd(evt) {
            const wasDragging = state.isDragging;
            const draggedNodeId = state.draggedNode?.id;

            state.isDragging = false;
            state.draggedNode = null;

            if (wasDragging) {
                const mousePos = getMousePosition(evt);
                const dist = Math.sqrt(Math.pow(mousePos.x - state.dragStartX, 2) + Math.pow(mousePos.y - state.dragStartY, 2));
                
                if (dist < 5) { // ë“œë˜ê·¸ ê±°ë¦¬ê°€ ì§§ìœ¼ë©´ í´ë¦­ìœ¼ë¡œ ê°„ì£¼
                    if (draggedNodeId) { // 'center' ë…¸ë“œë¥¼ í¬í•¨í•œ ëª¨ë“  ë…¸ë“œ í´ë¦­ ì²˜ë¦¬
                        handleNodeClick(draggedNodeId);
                    }
                }
            }
        }

        // --- ì• ë‹ˆë©”ì´ì…˜ ë° UI ì—…ë°ì´íŠ¸ ---
        function startAnimationSequence() {
            if (state.selectedNode && state.selectedNode !== 'center') {
                setTimeout(() => { state.discoveryPhase = 1; }, 1000);
                setTimeout(() => { state.discoveryPhase = 2; }, 2500);
                setTimeout(() => { state.showSolution = true; }, 3500);
            }
        }

        function updatePhysics() {
            nodes.forEach(node1 => {
                if (node1.id === 'center' || state.draggedNode?.id === node1.id) return;

                // ë‹¤ë¥¸ ë…¸ë“œì™€ì˜ ë°˜ë°œë ¥
                nodes.forEach(node2 => {
                    if (node1 === node2) return;
                    const dx = node1.x - node2.x;
                    const dy = node1.y - node2.y;
                    const distSq = dx * dx + dy * dy;
                    if (distSq < 1) distSq = 1; // 0ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê²ƒ ë°©ì§€
                    const force = physics.repulsion / distSq;
                    node1.vx += (dx / Math.sqrt(distSq)) * force;
                    node1.vy += (dy / Math.sqrt(distSq)) * force;
                });

                // ì—°ê²°ëœ ë…¸ë“œì™€ì˜ ì¸ë ¥ (ìŠ¤í”„ë§)
                connections.forEach(conn => {
                    if (conn.from === node1.id || conn.to === node1.id) {
                        const otherNodeId = conn.from === node1.id ? conn.to : conn.from;
                        const otherNode = nodes.find(n => n.id === otherNodeId);
                        const dx = otherNode.x - node1.x;
                        const dy = otherNode.y - node1.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        const displacement = dist - physics.idealLength;
                        const force = displacement * physics.spring;
                        node1.vx += (dx / dist) * force;
                        node1.vy += (dy / dist) * force;
                    }
                });

                // ì¤‘ì•™ìœ¼ë¡œì˜ ì¸ë ¥
                const dx = 400 - node1.x;
                const dy = 300 - node1.y;
                node1.vx += dx * physics.centering;
                node1.vy += dy * physics.centering;

                // ê°ì†
                node1.vx *= physics.damping;
                node1.vy *= physics.damping;

                // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                node1.x += node1.vx;
                node1.y += node1.vy;
            });
        }
        
        function mainLoop() {
            if (!state.isDragging) {
                updatePhysics();
            }
            // UI ì—…ë°ì´íŠ¸ëŠ” ë¬¼ë¦¬ ê³„ì‚°ê³¼ ë³„ê°œë¡œ í•­ìƒ ì‹¤í–‰ë˜ì–´ì•¼ ë¶€ë“œëŸ¬ìš´ ë“œë˜ê·¸ê°€ ê°€ëŠ¥
            updateUI();
            requestAnimationFrame(mainLoop);
        }

        function updateUI() {
            updateSteps();
            updateNodes();
            updateConnections();
            updateSolutionPanel();
            updateUsageGuide();
            updateResetButton();
        }

        function updateSteps() {
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            if (state.selectedNode) { step1.className = 'step active-red'; step1.querySelector('.step-number').className = 'step-number red'; } 
            else { step1.className = 'step inactive'; step1.querySelector('.step-number').className = 'step-number gray'; }
            if (state.discoveryPhase >= 1) { step2.className = 'step active-orange'; step2.querySelector('.step-number').className = 'step-number orange'; } 
            else { step2.className = 'step inactive'; step2.querySelector('.step-number').className = 'step-number gray'; }
            if (state.showSolution) { step3.className = 'step active-green'; step3.querySelector('.step-number').className = 'step-number green'; } 
            else { step3.className = 'step inactive'; step3.querySelector('.step-number').className = 'step-number gray'; }
        }

        function updateResetButton() { document.getElementById('reset-btn').style.display = state.selectedNode ? 'flex' : 'none'; }

        function updateConnections() {
            connectionsGroup.innerHTML = '';

            const amounts = nodes
                .filter(n => n.type !== 'center')
                .map(n => parseInt(n.amount.replace(/[,ì›]/g, '')));
            const minAmount = Math.min(...amounts);
            const maxAmount = Math.max(...amounts);
            const minStroke = 1.5;
            const maxStroke = 10;

            function getStrokeWidth(amountStr) {
                const amount = parseInt(amountStr.replace(/[,ì›]/g, ''));
                if (maxAmount === minAmount) return (minStroke + maxStroke) / 2;
                // ê¸ˆì•¡ì— ë¡œê·¸ë¥¼ ì·¨í•´ ìŠ¤ì¼€ì¼ì„ ì¡°ì •í•˜ì—¬ ì‘ì€ ê¸ˆì•¡ë„ ë³´ì´ê²Œ í•¨
                const logAmount = Math.log(amount);
                const logMin = Math.log(minAmount);
                const logMax = Math.log(maxAmount);
                return minStroke + (maxStroke - minStroke) * (logAmount - logMin) / (logMax - logMin);
            }

            connections.forEach(connection => {
                const fromNode = nodes.find(n => n.id === connection.from);
                const toNode = nodes.find(n => n.id === connection.to);
                const isActive = isConnectionActive(connection);
                const { startX, startY, endX, endY } = calculateLinePoints(fromNode, toNode);
                
                const strokeWidth = getStrokeWidth(toNode.amount);

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', startX);
                line.setAttribute('y1', startY);
                line.setAttribute('x2', endX);
                line.setAttribute('y2', endY);
                line.setAttribute('stroke', isActive ? '#dc2626' : '#9ca3af');
                line.setAttribute('stroke-width', isActive ? strokeWidth * 1.5 : strokeWidth);
                line.setAttribute('opacity', isActive ? 1 : 0.5);
                line.setAttribute('marker-end', isActive ? 'url(#arrowhead)' : 'url(#arrowhead-inactive)');
                if (isActive) line.setAttribute('filter', 'url(#glow)');
                connectionsGroup.appendChild(line);
            });
        }

        function updateNodes() {
            nodesGroup.innerHTML = '';
            nodes.forEach(node => {
                const isHighlighted = isNodeHighlighted(node);
                const isInefficient = node.inefficient && state.discoveryPhase >= 1;
                const showWarningBorder = node.inefficient && (isHighlighted || isInefficient);

                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('class', 'node-group');
                g.setAttribute('data-id', node.id);
                g.setAttribute('transform', `translate(${node.x}, ${node.y})`);

                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('r', node.size);
                circle.setAttribute('fill', isInefficient ? '#dc2626' : '#e5e7eb');
                circle.setAttribute('stroke', isHighlighted ? '#dc2626' : '#d1d5db');
                circle.setAttribute('stroke-width', isHighlighted ? 4 : 1);
                circle.setAttribute('opacity', 0.9);
                if (isHighlighted) circle.setAttribute('filter', 'url(#glow)');
                g.appendChild(circle);

                if (showWarningBorder) {
                    const warningBorder = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    warningBorder.setAttribute('r', node.size + 8);
                    warningBorder.setAttribute('fill', 'none');
                    warningBorder.setAttribute('stroke', '#dc2626');
                    warningBorder.setAttribute('stroke-width', 2);
                    warningBorder.setAttribute('stroke-dasharray', '5,3');
                    warningBorder.setAttribute('opacity', 0.8);
                    warningBorder.className = 'animate-pulse';
                    g.appendChild(warningBorder);
                }
                
                if (isInefficient) {
                    const pingCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    pingCircle.setAttribute('r', node.size + 10);
                    pingCircle.setAttribute('fill', 'none');
                    pingCircle.setAttribute('stroke', '#dc2626');
                    pingCircle.setAttribute('stroke-width', 3);
                    pingCircle.setAttribute('opacity', 0);
                    pingCircle.className = 'animate-ping';
                    g.appendChild(pingCircle);
                }
                
                let displayText = '';
                if (node.type === 'center') { displayText = 'ì´ ì§€ì¶œ'; } 
                else {
                    if (node.detail.includes('ì¹´ë“œ')) displayText = node.detail.split(' ')[0];
                    else if (node.detail.includes('ì€í–‰')) displayText = node.detail.split(' ')[0];
                    else if (node.detail.includes('AlphaT')) displayText = 'AlphaT';
                    else displayText = node.detail.split(' ')[0];
                }
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('y', 2);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-weight', 'bold');
                text.setAttribute('font-size', node.type === 'center' ? '14' : '12');
                text.setAttribute('fill', isInefficient ? 'white' : '#4b5563');
                text.textContent = displayText;
                g.appendChild(text);

                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('y', node.size + 18);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('font-size', '14');
                label.setAttribute('font-weight', 'bold');
                label.setAttribute('fill', '#374151');
                label.textContent = node.label;
                g.appendChild(label);

                const amount = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                amount.setAttribute('y', node.size + 32);
                amount.setAttribute('text-anchor', 'middle');
                amount.setAttribute('font-size', '14');
                amount.setAttribute('font-weight', 'bold');
                amount.setAttribute('fill', isHighlighted ? '#dc2626' : '#6b7280');
                amount.textContent = node.amount;
                g.appendChild(amount);

                const detail = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                detail.setAttribute('y', node.size + 46);
                detail.setAttribute('text-anchor', 'middle');
                detail.setAttribute('font-size', '12');
                detail.setAttribute('fill', '#6b7280');
                detail.textContent = node.detail;
                g.appendChild(detail);

                if (isHighlighted) {
                    let yOffset = node.size + 64;
                    if (node.inefficient && node.reason) {
                        const reasonText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        reasonText.setAttribute('y', yOffset);
                        reasonText.setAttribute('text-anchor', 'middle');
                        reasonText.setAttribute('font-size', '12');
                        reasonText.setAttribute('font-weight', 'bold');
                        reasonText.setAttribute('fill', '#ef4444');
                        reasonText.textContent = `[!] ${node.reason}`;
                        g.appendChild(reasonText);
                        yOffset += 18;
                    }
                    if (node.subDetails) {
                        node.subDetails.forEach((subDetail, idx) => {
                            const subText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                            subText.setAttribute('y', yOffset + (idx * 14));
                            subText.setAttribute('text-anchor', 'middle');
                            subText.setAttribute('font-size', '12');
                            subText.setAttribute('font-weight', '500');
                            subText.setAttribute('fill', '#dc2626');
                            subText.textContent = `â€¢ ${subDetail}`;
                            g.appendChild(subText);
                        });
                    }
                }

                if (isInefficient) {
                    const foreignObject = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');
                    foreignObject.setAttribute('x', node.size - 8);
                    foreignObject.setAttribute('y', -node.size + 8);
                    foreignObject.setAttribute('width', 16);
                    foreignObject.setAttribute('height', 16);
                    foreignObject.innerHTML = '<div style="color: #f59e0b; animation: bounce 1s infinite;">âš ï¸</div>';
                    g.appendChild(foreignObject);
                }
                
                nodesGroup.appendChild(g);
            });
        }

        function updateSolutionPanel() {
            const panel = document.getElementById('solution-panel');
            if (state.showSolution && state.selectedNode) {
                panel.style.display = 'block';
                let nodeData = nodes.find(n => n.id === state.selectedNode);
                let content = `<div class="solution-header"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2"><path d="M9 12l2 2 4-4"/><path d="M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.745 3.745 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.745 3.745 0 0 1 3.296-1.043A3.745 3.745 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.745 3.745 0 0 1 3.296 1.043 3.745 3.745 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12z"/></svg><h3 style="font-size: 1.125rem; font-weight: bold; color: #374151;">ğŸ’¡ ìŠ¤ë§ˆíŠ¸ ì œì•ˆ</h3></div><div class="solution-content">`;
                
                if (state.selectedNode === 'phone') {
                    content += `<p style="color: #6b7280;"><strong>AlphaT ìë™ì´ì²´</strong> ìš”ê¸ˆì´ ìœ ì‚¬ ì„œë¹„ìŠ¤ ëŒ€ë¹„ 26% ë†’ìŠµë‹ˆë‹¤</p><div class="solution-card"><div class="solution-details"><div class="solution-left"><div class="solution-action"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg><span style="font-weight: 500; color: #374151;">ì•Œëœ°í°ìœ¼ë¡œ ë³€ê²½</span></div><div style="font-size: 0.875rem; color: #6b7280;">í˜„ì¬: AlphaT 5G í”„ë¦¬ë¯¸ì–´ â†’ ì œì•ˆ: BetaT ì•Œëœ°í° 5G</div></div><div class="solution-right"><div class="savings-amount">-23,000ì›/ì›”</div><div class="savings-period">ì—°ê°„ 276,000ì› ì ˆì•½</div></div></div><div class="solution-tip">ğŸ’¡ ë™ì¼ ë°ì´í„° ì œê³µ, í†µí™”í’ˆì§ˆ 99% ë™ì¼</div></div><button class="solution-btn"><span>ì•Œëœ°í° ì‹ ì²­í•˜ê¸°</span><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14m-7-7 7 7-7 7"/></svg></button>`;
                } else if (state.selectedNode === 'utility') {
                    content += `<p style="color: #6b7280;"><strong>Wì€í–‰ ****-7890</strong> ê³„ì¢Œì˜ ì „ê¸°ë£Œê°€ ëˆ„ì§„ì„¸ 3ë‹¨ê³„ì…ë‹ˆë‹¤</p><div class="solution-card"><div class="solution-details"><div class="solution-left"><div class="solution-action"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2"><path d="M9 12l2 2 4-4"/><path d="M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.745 3.745 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.745 3.745 0 0 1 3.296-1.043A3.745 3.745 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.745 3.745 0 0 1 3.296 1.043 3.745 3.745 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12z"/></svg><span style="font-weight: 500; color: #374151;">ì—ë„ˆì§€ ìš”ê¸ˆ ìµœì í™”</span></div><div style="font-size: 0.875rem; color: #6b7280;">ì „ê¸°ë£Œ ëˆ„ì§„ì„¸ 3ë‹¨ê³„ â†’ 2ë‹¨ê³„ë¡œ ì ˆì•½</div></div><div class="solution-right"><div class="savings-amount">-34,500ì›/ì›”</div><div class="savings-period">ì—°ê°„ 414,000ì› ì ˆì•½</div></div></div><div class="solution-tip">ğŸ’¡ ìŠ¤ë§ˆíŠ¸ í”ŒëŸ¬ê·¸ + ì‹œê°„ëŒ€ë³„ ìš”ê¸ˆì œ ë³€ê²½</div></div><button class="solution-btn"><span>ì—ë„ˆì§€ ì ˆì•½ í”Œëœ ì‹œì‘í•˜ê¸°</span><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14m-7-7 7 7-7 7"/></svg></button>`;
                } else if (state.selectedNode === 'home') {
                    content += `<p style="color: #6b7280;"><strong>Kì€í–‰ ****-2847</strong> ì›”ì„¸ ê´€ë ¨ ì„¸ì•¡ê³µì œ ë¯¸ì‹ ì²­ ìƒíƒœ</p><div class="solution-card"><div class="solution-details"><div class="solution-left"><div class="solution-action"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg><span style="font-weight: 500; color: #374151;">ì›”ì„¸ ì„¸ì•¡ê³µì œ ì‹ ì²­</span></div><div style="font-size: 0.875rem; color: #6b7280;">ì—° ì†Œë“ 7ì²œë§Œì› ì´í•˜ â†’ ì›”ì„¸ 750ë§Œì› í•œë„ 12% ê³µì œ</div></div><div class="solution-right"><div class="savings-amount">-90,000ì›/ë…„</div><div class="savings-period">ì„¸ê¸ˆ í™˜ê¸‰</div></div></div><div class="solution-tip">ğŸ’¡ í™ˆíƒìŠ¤ì—ì„œ 5ë¶„ ë§Œì— ì‹ ì²­ ì™„ë£Œ ê°€ëŠ¥</div></div><button class="solution-btn"><span>í™ˆíƒìŠ¤ì—ì„œ ì‹ ì²­í•˜ê¸°</span><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14m-7-7 7 7-7 7"/></svg></button>`;
                }
                
                content += `</div>`;
                panel.innerHTML = content;
            } else {
                panel.style.display = 'none';
            }
        }
        function updateUsageGuide() {
            const usageText = document.getElementById('usage-text');
            const analysisText = document.getElementById('analysis-text');
            
            if (!state.selectedNode) {
                usageText.style.display = 'block';
                analysisText.style.display = 'none';
                usageText.textContent = 'ğŸ’¡ ë¨¼ì € ì¤‘ì•™ì˜ \'ì´ ì§€ì¶œ\' ë…¸ë“œë¥¼ í´ë¦­í•˜ì—¬ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.';
            } else if (state.selectedNode === 'center') {
                usageText.style.display = 'block';
                analysisText.style.display = 'none';
                usageText.textContent = 'ğŸ’¡ ë¶„ì„í•˜ê³  ì‹¶ì€ ì§€ì¶œ í•­ëª©ì„ í´ë¦­í•˜ì„¸ìš”.';
            } else if (state.selectedNode && !state.showSolution) {
                usageText.style.display = 'none';
                analysisText.style.display = 'block';
                
                let text = 'AIê°€ ';
                if (state.selectedNode === 'phone') text += 'AlphaT ìš”ê¸ˆì œë¥¼';
                else if (state.selectedNode === 'home') text += 'Kì€í–‰ ì›”ì„¸ í˜œíƒì„';
                else if (state.selectedNode === 'utility') text += 'Wì€í–‰ ì „ê¸°ë£Œë¥¼';
                else text += 'ì§€ì¶œ íŒ¨í„´ì„';
                text += ' ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                
                analysisText.textContent = text;
            } else {
                usageText.style.display = 'none';
                analysisText.style.display = 'none';
            }
        }
        
        // --- ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
        document.getElementById('reset-btn').onclick = handleReset;
        
        svg.addEventListener('mousedown', onDragStart);
        svg.addEventListener('mousemove', onDrag);
        svg.addEventListener('mouseup', onDragEnd);
        svg.addEventListener('mouseleave', onDragEnd);

        svg.addEventListener('touchstart', onDragStart);
        svg.addEventListener('touchmove', onDrag);
        svg.addEventListener('touchend', onDragEnd);

        mainLoop(); // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì‹œì‘
    </script>
</body>
</html>
